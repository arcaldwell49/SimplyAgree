<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Power Analysis and Sample Size Determination for Agreement Studies • SimplyAgree</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Power Analysis and Sample Size Determination for Agreement Studies">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SimplyAgree</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/agree_tests.html">Agreement Tests</a></li>
    <li><a class="dropdown-item" href="../articles/agreement_analysis.html">Agreement &amp; Tolerance Limits</a></li>
    <li><a class="dropdown-item" href="../articles/Deming.html">Errors-in-Variables Regression</a></li>
    <li><a class="dropdown-item" href="../articles/power_sample_size_vignette.html">Power Analysis and Sample Size Determination for Agreement Studies</a></li>
    <li><a class="dropdown-item" href="../articles/reanalysis.html">Re-analysis of an Agreement Study</a></li>
    <li><a class="dropdown-item" href="../articles/reliability_analysis.html">Reliability Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/arcaldwell49/SimplyAgree/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Power Analysis and Sample Size Determination for Agreement Studies</h1>
                        <h4 data-toc-skip class="author">Aaron R.
Caldwell</h4>
            
            <h4 data-toc-skip class="date">Last Updated: 2026-01-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/arcaldwell49/SimplyAgree/blob/master/vignettes/power_sample_size_vignette.Rmd" class="external-link"><code>vignettes/power_sample_size_vignette.Rmd</code></a></small>
      <div class="d-none name"><code>power_sample_size_vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette provides comprehensive guidance on power analysis and
sample size determination for method comparison and agreement studies
using the <code>SimplyAgree</code> package.</p>
<div class="section level3">
<h3 id="available-methods">Available Methods<a class="anchor" aria-label="anchor" href="#available-methods"></a>
</h3>
<p><code>SimplyAgree</code> implements four approaches to power/sample
size calculations:</p>
<ol style="list-style-type: decimal">
<li>
<strong><code><a href="../reference/power_agreement_exact.html">power_agreement_exact()</a></code></strong> - Exact
agreement test <span class="citation">(<a href="#ref-shieh2019">Shieh
2019</a>)</span>
</li>
<li>
<strong><code><a href="../reference/blandPowerCurve.html">blandPowerCurve()</a></code></strong> - Bland-Altman power
curves <span class="citation">(<a href="#ref-lu2016">Lu et al.
2016</a>)</span>
</li>
<li>
<strong><code><a href="../reference/agree_expected_half.html">agree_expected_half()</a></code></strong> - Expected
half-width criterion <span class="citation">(<a href="#ref-JanShieh2018">Jan and Shieh 2018</a>)</span>
</li>
<li>
<strong><code><a href="../reference/agree_assurance.html">agree_assurance()</a></code></strong> - Assurance
probability criterion <span class="citation">(<a href="#ref-JanShieh2018">Jan and Shieh 2018</a>)</span>
</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://aaroncaldwell.us/SimplyAgree/">SimplyAgree</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="understanding-the-approaches">Understanding the Approaches<a class="anchor" aria-label="anchor" href="#understanding-the-approaches"></a>
</h2>
<div class="section level3">
<h3 id="hypothesis-testing-vs--estimation">Hypothesis Testing vs. Estimation<a class="anchor" aria-label="anchor" href="#hypothesis-testing-vs--estimation"></a>
</h3>
<p>The methods divide into two categories:</p>
<p><strong>Hypothesis Testing</strong> (binary decision):</p>
<ul>
<li>
<code><a href="../reference/power_agreement_exact.html">power_agreement_exact()</a></code> - Tests if central proportion,
essentially tolerance intevals, are within the maximal allowable
difference</li>
<li>
<code><a href="../reference/blandPowerCurve.html">blandPowerCurve()</a></code> - Tests if confidence intervals of
limits of agreement fall within the maximal allowable difference</li>
</ul>
<p><strong>Estimation</strong> (quantifying precision):</p>
<ul>
<li>
<code><a href="../reference/agree_expected_half.html">agree_expected_half()</a></code> - Controls average CI half-width
of limits of agreement</li>
<li>
<code><a href="../reference/agree_assurance.html">agree_assurance()</a></code> - Controls probability of achieving
target CI half-width of limits of agreement</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="method-1-exact-agreement-test">Method 1: Exact Agreement Test<a class="anchor" aria-label="anchor" href="#method-1-exact-agreement-test"></a>
</h2>
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>Tests whether the central P* proportion of paired differences falls
within the maximal allowable difference [-delta, delta].</p>
<p><strong>Hypotheses:</strong></p>
<ul>
<li>H0: Methods disagree (central portion extends beyond bounds)</li>
<li>H1: Methods agree (central portion within bounds)</li>
</ul>
</div>
<div class="section level3">
<h3 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/power_agreement_exact.html">power_agreement_exact</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="cn">NULL</span>,           <span class="co"># Sample size</span></span>
<span>  delta <span class="op">=</span> <span class="cn">NULL</span>,       <span class="co"># Tolerance bound</span></span>
<span>  mu <span class="op">=</span> <span class="fl">0</span>,            <span class="co"># Mean of differences</span></span>
<span>  sigma <span class="op">=</span> <span class="cn">NULL</span>,       <span class="co"># SD of differences</span></span>
<span>  p0_star <span class="op">=</span> <span class="fl">0.95</span>,    <span class="co"># Central proportion (tolerance coverage)</span></span>
<span>  power <span class="op">=</span> <span class="cn">NULL</span>,       <span class="co"># Target power</span></span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>       <span class="co"># Significance level</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Specify <strong>exactly three</strong> of: n, delta, power,
sigma.</p>
</div>
<div class="section level3">
<h3 id="example-sample-size-calculation">Example: Sample Size Calculation<a class="anchor" aria-label="anchor" href="#example-sample-size-calculation"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Blood pressure device comparison</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_agreement_exact.html">power_agreement_exact</a></span><span class="op">(</span></span>
<span>  delta <span class="op">=</span> <span class="fl">7</span>,          <span class="co"># +/-7 mmHg tolerance</span></span>
<span>  mu <span class="op">=</span> <span class="fl">0.5</span>,          <span class="co"># Expected bias</span></span>
<span>  sigma <span class="op">=</span> <span class="fl">2.5</span>,       <span class="co"># Expected SD</span></span>
<span>  p0_star <span class="op">=</span> <span class="fl">0.95</span>,    <span class="co"># 95% must be within bounds</span></span>
<span>  power <span class="op">=</span> <span class="fl">0.80</span>,      <span class="co"># 80% power</span></span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Maximum iterations reached in gamma computation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Power for Exact Method for Assessing Agreement Between Two Methods </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               n = 34</span></span>
<span><span class="co">#&gt;           delta = 7</span></span>
<span><span class="co">#&gt;              mu = 0.5</span></span>
<span><span class="co">#&gt;           sigma = 2.5</span></span>
<span><span class="co">#&gt;         p0_star = 0.95</span></span>
<span><span class="co">#&gt;         p1_star = 0.9939889</span></span>
<span><span class="co">#&gt;           alpha = 0.05</span></span>
<span><span class="co">#&gt;           power = 0.8018321</span></span>
<span><span class="co">#&gt;  critical_value = 13.57044</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; NOTE: H0: Central 95% of differences not within [-delta, delta]</span></span>
<span><span class="co">#&gt;      H1: Central 99.4% of differences within [-delta, delta] </span></span>
<span><span class="co">#&gt; n is number pairs. Two measurements per unit; one for each method.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="method-2-bland-altman-power-curves">Method 2: Bland-Altman Power Curves<a class="anchor" aria-label="anchor" href="#method-2-bland-altman-power-curves"></a>
</h2>
<div class="section level3">
<h3 id="overview-1">Overview<a class="anchor" aria-label="anchor" href="#overview-1"></a>
</h3>
<p>Calculates power curves using approximate Bland-Altman confidence
intervals using the method of <span class="citation">Lu et al. (<a href="#ref-lu2016">2016</a>)</span> (which is approximate). Useful for
exploring power across sample sizes.</p>
</div>
<div class="section level3">
<h3 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/blandPowerCurve.html">blandPowerCurve</a></span><span class="op">(</span></span>
<span>  samplesizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>,  <span class="co"># Range of sample sizes</span></span>
<span>  mu <span class="op">=</span> <span class="fl">0</span>,                          <span class="co"># Mean difference</span></span>
<span>  <span class="va">SD</span>,                              <span class="co"># SD of differences</span></span>
<span>  <span class="va">delta</span>,                           <span class="co"># Tolerance bound(s)</span></span>
<span>  conf.level <span class="op">=</span> <span class="fl">0.95</span>,              <span class="co"># CI confidence level</span></span>
<span>  agree.level <span class="op">=</span> <span class="fl">0.95</span>               <span class="co"># LOA agreement level</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-power-curve">Example: Power Curve<a class="anchor" aria-label="anchor" href="#example-power-curve"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate power curve</span></span>
<span><span class="va">pc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blandPowerCurve.html">blandPowerCurve</a></span><span class="op">(</span></span>
<span>  samplesizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">200</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  mu <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  SD <span class="op">=</span> <span class="fl">3.3</span>,</span>
<span>  delta <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  conf.level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  agree.level <span class="op">=</span> <span class="fl">0.95</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pc</span>, type <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="power_sample_size_vignette_files/figure-html/bland_ex1-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Find n for 80% power</span></span>
<span><span class="fu"><a href="../reference/powerCurve-methods.html">find_n</a></span><span class="op">(</span><span class="va">pc</span>, power <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;   delta conf.level agree.level power     N</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     8       0.95        0.95 0.800   145</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="method-3-expected-half-width">Method 3: Expected Half-Width<a class="anchor" aria-label="anchor" href="#method-3-expected-half-width"></a>
</h2>
<div class="section level3">
<h3 id="overview-2">Overview<a class="anchor" aria-label="anchor" href="#overview-2"></a>
</h3>
<p>Determines sample size to ensure <strong>average</strong> CI
half-width &lt;= delta across hypothetical repeated studies.</p>
</div>
<div class="section level3">
<h3 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/agree_expected_half.html">agree_expected_half</a></span><span class="op">(</span></span>
<span>  conf.level <span class="op">=</span> <span class="fl">0.95</span>,    <span class="co"># CI confidence level</span></span>
<span>  delta <span class="op">=</span> <span class="cn">NULL</span>,         <span class="co"># Target expected half-width</span></span>
<span>  pstar <span class="op">=</span> <span class="fl">0.95</span>,        <span class="co"># Central proportion</span></span>
<span>  sigma <span class="op">=</span> <span class="fl">1</span>,           <span class="co"># SD of differences</span></span>
<span>  n <span class="op">=</span> <span class="cn">NULL</span>             <span class="co"># Sample size</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Specify <strong>either</strong> n OR delta.</p>
</div>
<div class="section level3">
<h3 id="example-sample-size-for-precision">Example: Sample Size for Precision<a class="anchor" aria-label="anchor" href="#example-sample-size-for-precision"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Want E[H] &lt;= 2.5*sigma</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/agree_expected_half.html">agree_expected_half</a></span><span class="op">(</span></span>
<span>  conf.level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  delta <span class="op">=</span> <span class="fl">2.5</span>,         <span class="co"># As multiple of sigma</span></span>
<span>  pstar <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fl">1</span>            <span class="co"># Standardized</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Expected half-width and sample size for limits of agreement </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               n = 52</span></span>
<span><span class="co">#&gt;      conf.level = 0.95</span></span>
<span><span class="co">#&gt;    target.delta = 2.5</span></span>
<span><span class="co">#&gt;    actual.delta = 2.49677</span></span>
<span><span class="co">#&gt;           pstar = 0.95</span></span>
<span><span class="co">#&gt;           sigma = 1</span></span>
<span><span class="co">#&gt;               g = 2.509039</span></span>
<span><span class="co">#&gt;               c = 1.004914</span></span>
<span><span class="co">#&gt;              zp = 1.959964</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="method-4-assurance-probability">Method 4: Assurance Probability<a class="anchor" aria-label="anchor" href="#method-4-assurance-probability"></a>
</h2>
<div class="section level3">
<h3 id="overview-3">Overview<a class="anchor" aria-label="anchor" href="#overview-3"></a>
</h3>
<p>Determines sample size to ensure <strong>probability</strong> that CI
half-width &lt;= omega is at least (1-gamma).</p>
<p>Stronger guarantee than expected half-width — ensures specific
probability of achieving target precision.</p>
</div>
<div class="section level3">
<h3 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/agree_assurance.html">agree_assurance</a></span><span class="op">(</span></span>
<span>  conf.level <span class="op">=</span> <span class="fl">0.95</span>,     <span class="co"># CI confidence level</span></span>
<span>  assurance <span class="op">=</span> <span class="fl">0.90</span>,      <span class="co"># Target assurance probability</span></span>
<span>  omega <span class="op">=</span> <span class="cn">NULL</span>,          <span class="co"># Target half-width bound</span></span>
<span>  pstar <span class="op">=</span> <span class="fl">0.95</span>,         <span class="co"># Central proportion</span></span>
<span>  sigma <span class="op">=</span> <span class="fl">1</span>,            <span class="co"># SD of differences</span></span>
<span>  n <span class="op">=</span> <span class="cn">NULL</span>              <span class="co"># Sample size</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Specify <strong>either</strong> n OR omega.</p>
</div>
<div class="section level3">
<h3 id="example-sample-size-with-guarantee">Example: Sample Size with Guarantee<a class="anchor" aria-label="anchor" href="#example-sample-size-with-guarantee"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Want 90% probability that H &lt;= 2.5*sigma</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/agree_assurance.html">agree_assurance</a></span><span class="op">(</span></span>
<span>  conf.level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  assurance <span class="op">=</span> <span class="fl">0.90</span>,    <span class="co"># 90% probability</span></span>
<span>  omega <span class="op">=</span> <span class="fl">2.5</span>,         <span class="co"># Target bound</span></span>
<span>  pstar <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Assurance probability &amp; sample size for Limits of Agreement </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                n = 115</span></span>
<span><span class="co">#&gt;       conf.level = 0.95</span></span>
<span><span class="co">#&gt;        assurance = 0.9</span></span>
<span><span class="co">#&gt; actual.assurance = 0.9024848</span></span>
<span><span class="co">#&gt;            omega = 2.5</span></span>
<span><span class="co">#&gt;            pstar = 0.95</span></span>
<span><span class="co">#&gt;            sigma = 1</span></span>
<span><span class="co">#&gt;                g = 2.306167</span></span>
<span><span class="co">#&gt;               zp = 1.959964</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="decision-guide-for-the-method">Decision Guide for the Method<a class="anchor" aria-label="anchor" href="#decision-guide-for-the-method"></a>
</h2>
<pre><code>Research Goal?
|
|- Hypothesis Testing -&gt; 
|   \- Need exact Type I error control -&gt; Power for Agreement
|
\- Precision Estimation -&gt;
    |- Average precision sufficient -&gt; Expected Half-Width
    \- Need probabilistic guarantee -&gt; Assurance Probability</code></pre>
</div>
<div class="section level2">
<h2 id="handling-clusterednested-data">Handling Clustered/Nested Data<a class="anchor" aria-label="anchor" href="#handling-clusterednested-data"></a>
</h2>
<div class="section level3">
<h3 id="the-problem">The Problem<a class="anchor" aria-label="anchor" href="#the-problem"></a>
</h3>
<p>Many studies have <strong>clustered</strong> data where there are
multiple measurements per subject or natural groupings (e.g., repeated
measures, multi-center studies). Note, the advice here only applies to
clustering but not to situations where replicate measures are taken
within a measurement occasion (e.g., multiple measures at the same time
point wherein any variation would only represent measurement error).</p>
<p>Standard formulas assume independence<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Implications of which are discussed by &lt;span class="citation"&gt;Bland (&lt;a href="#ref-bland2003cluster"&gt;2003&lt;/a&gt;)&lt;/span&gt;
among many others&lt;/p&gt;'><sup>1</sup></a>. Ignoring clustering
can leads to studies that lack precision. To my knowledge, there is no
well developed methods for accounting for clustering in sample size
calculations for agreement studies, so we use a common approximation
from survey sampling and multilevel modeling: the <strong>design
effect</strong>.</p>
</div>
<div class="section level3">
<h3 id="my-best-approximation-design-effect">My Best Approximation: Design Effect<a class="anchor" aria-label="anchor" href="#my-best-approximation-design-effect"></a>
</h3>
<p>The design effect (DEFF) quantifies loss of efficiency due to
clustering:</p>
<p><span class="math display">\[\text{DEFF} = 1 + (m - 1) \times
\text{ICC}\]</span></p>
<p>where:</p>
<ul>
<li>m = observations per cluster</li>
<li>ICC = intraclass correlation coefficient</li>
<li>
<span class="math inline">\(n_{ESS}\)</span> = effective sample
size</li>
</ul>
<p><strong>Effect on sample size:</strong> <span class="math display">\[n_{\text{ESS}} = n_{\text{independent}} \times
\text{DEFF}\]</span></p>
</div>
<div class="section level3">
<h3 id="understanding-icc">Understanding ICC<a class="anchor" aria-label="anchor" href="#understanding-icc"></a>
</h3>
<p>ICC = proportion of variance between clusters:</p>
<p><span class="math display">\[\text{ICC} =
\frac{\sigma^2_{\text{between}}}{\sigma^2_{\text{between}} +
\sigma^2_{\text{within}}}\]</span></p>
</div>
<div class="section level3">
<h3 id="application-workflow">Application Workflow<a class="anchor" aria-label="anchor" href="#application-workflow"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Calculate independent sample size (using power function)</li>
<li>Determine m (observations per cluster)</li>
<li>Estimate ICC (from pilot data, literature, or theory)</li>
<li>Calculate DEFF = 1 + (m-1)*ICC</li>
<li>Inflate: n_total = n_indep * DEFF</li>
<li>Calculate clusters: K = the smallest integer greater than or equal
to (n_total / m) (i.e., round up n_total / m)</li>
</ol>
</div>
<div class="section level3">
<h3 id="example-repeated-measures-design">Example: Repeated Measures Design<a class="anchor" aria-label="anchor" href="#example-repeated-measures-design"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1: Independent sample size</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_agreement_exact.html">power_agreement_exact</a></span><span class="op">(</span></span>
<span>  delta <span class="op">=</span> <span class="fl">7</span>, mu <span class="op">=</span> <span class="fl">0.5</span>, sigma <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  p0_star <span class="op">=</span> <span class="fl">0.95</span>, power <span class="op">=</span> <span class="fl">0.80</span>, alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Maximum iterations reached in gamma computation</span></span>
<span><span class="va">n_indep</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">n</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Independent pairs needed:"</span>, <span class="va">n_indep</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Independent pairs needed: 34</span></span>
<span></span>
<span><span class="co"># Step 2: Apply design effect</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">3</span>  <span class="co"># 3 measurements per participant</span></span>
<span><span class="va">ICC</span> <span class="op">&lt;-</span> <span class="fl">0.15</span>  <span class="co"># from pilot or literature</span></span>
<span><span class="va">DEFF</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="va">m</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">ICC</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Design effect:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">DEFF</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Design effect: 1.3</span></span>
<span></span>
<span><span class="co"># Step 3: Calculate participants needed</span></span>
<span><span class="va">n_ess</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">n_indep</span> <span class="op">*</span> <span class="va">DEFF</span><span class="op">)</span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">n_ess</span> <span class="op">/</span> <span class="va">m</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total observations:"</span>, <span class="va">n_ess</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total observations: 45</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Participants needed:"</span>, <span class="va">K</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Participants needed: 15</span></span></code></pre></div>
<p><strong>Result</strong>: Instead of 34 independent pairs, need ~15
participants (45 total observations).</p>
</div>
<div class="section level3">
<h3 id="impact-of-icc">Impact of ICC<a class="anchor" aria-label="anchor" href="#impact-of-icc"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare different ICC values</span></span>
<span><span class="va">n_indep</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span></span>
<span><span class="va">ICC_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span>, <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">ICC</span> <span class="kw">in</span> <span class="va">ICC_values</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">DEFF</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="va">m</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">ICC</span></span>
<span>  <span class="va">K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">n_indep</span> <span class="op">*</span> <span class="va">DEFF</span><span class="op">)</span> <span class="op">/</span> <span class="va">m</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"ICC = %.2f: Need %d participants\n"</span>, <span class="va">ICC</span>, <span class="va">K</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; ICC = 0.00: Need 13 participants</span></span>
<span><span class="co">#&gt; ICC = 0.05: Need 15 participants</span></span>
<span><span class="co">#&gt; ICC = 0.10: Need 17 participants</span></span>
<span><span class="co">#&gt; ICC = 0.15: Need 19 participants</span></span>
<span><span class="co">#&gt; ICC = 0.20: Need 20 participants</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="when-design-effect-works-well">When Design Effect Works Well<a class="anchor" aria-label="anchor" href="#when-design-effect-works-well"></a>
</h3>
<p><strong>Good situations:</strong></p>
<ul>
<li>Balanced designs (equal cluster sizes)</li>
<li>Moderate ICC (0.01 - 0.30)</li>
<li>Sufficient clusters (K &gt;= 10)</li>
<li>Simple two-level hierarchy</li>
</ul>
<p><strong>Problematic:</strong></p>
<ul>
<li>Highly unbalanced clusters</li>
<li>Very high ICC (&gt; 0.4)</li>
<li>Small number of clusters (K &lt; 10)</li>
<li>Complex correlation structures</li>
<li>Multiple levels of nesting</li>
</ul>
<p>For complex designs, consider simulation-based power analysis and
consult a statistician.</p>
</div>
<div class="section level3">
<h3 id="complete-example-with-clustering">Complete Example with Clustering<a class="anchor" aria-label="anchor" href="#complete-example-with-clustering"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Study parameters</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">3.3</span></span>
<span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fl">7</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">4</span>  <span class="co"># measurements per participant</span></span>
<span><span class="va">ICC</span> <span class="op">&lt;-</span> <span class="fl">0.15</span></span>
<span><span class="va">dropout</span> <span class="op">&lt;-</span> <span class="fl">0.20</span></span>
<span></span>
<span><span class="co"># Step 1: Independent sample size</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/power_agreement_exact.html">power_agreement_exact</a></span><span class="op">(</span></span>
<span>  delta <span class="op">=</span> <span class="va">delta</span>, mu <span class="op">=</span> <span class="fl">0</span>, sigma <span class="op">=</span> <span class="va">sigma</span>,</span>
<span>  p0_star <span class="op">=</span> <span class="fl">0.95</span>, power <span class="op">=</span> <span class="fl">0.80</span>, alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Maximum iterations reached in gamma computation</span></span>
<span></span>
<span><span class="co"># Step 2: Account for clustering</span></span>
<span><span class="va">DEFF</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="va">m</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">ICC</span></span>
<span><span class="va">n_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">n</span> <span class="op">*</span> <span class="va">DEFF</span><span class="op">)</span></span>
<span><span class="va">K_pre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">n_total</span> <span class="op">/</span> <span class="va">m</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3: Account for dropout</span></span>
<span><span class="va">K_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">K_pre</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">dropout</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Independent pairs:"</span>, <span class="va">result</span><span class="op">$</span><span class="va">n</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Independent pairs: 566</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Design effect:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">DEFF</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Design effect: 1.45</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Participants (no dropout):"</span>, <span class="va">K_pre</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Participants (no dropout): 206</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Participants to recruit:"</span>, <span class="va">K_final</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Participants to recruit: 258</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total measurements:"</span>, <span class="va">K_final</span> <span class="op">*</span> <span class="va">m</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total measurements: 1032</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="practical-recommendations">Practical Recommendations<a class="anchor" aria-label="anchor" href="#practical-recommendations"></a>
</h2>
<div class="section level3">
<h3 id="planning-checklist">Planning Checklist<a class="anchor" aria-label="anchor" href="#planning-checklist"></a>
</h3>
<ul>
<li><label><input type="checkbox">Define research question (hypothesis
test vs. estimation)</label></li>
<li><label><input type="checkbox">Choose appropriate power
method</label></li>
<li>If possible, obtain pilot estimates (SD, ICC if clustered)</li>
<li><label><input type="checkbox">Calculate independent sample
size</label></li>
<li><label><input type="checkbox">Adjust for clustering (if
applicable)</label></li>
<li><label><input type="checkbox">Adjust for dropout</label></li>
<li><label><input type="checkbox">Conduct sensitivity
analyses</label></li>
<li><label><input type="checkbox">Document all assumptions and
sources</label></li>
<li><label><input type="checkbox">Pre-register before data
collection</label></li>
</ul>
</div>
<div class="section level3">
<h3 id="conservative-planning">Conservative Planning<a class="anchor" aria-label="anchor" href="#conservative-planning"></a>
</h3>
<p>When uncertain:</p>
<ul>
<li>Use <strong>upper range</strong> of plausible SD estimates</li>
<li>Use <strong>upper range</strong> of plausible ICC estimates</li>
<li>Build in <strong>10-20% buffer</strong> beyond calculated required
sample size</li>
<li>Conduct <strong>sensitivity analyses</strong> for key parameters
(SD, ICC, etc)</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bland2003cluster" class="csl-entry">
Bland, J. Martin. 2003. <span>“Cluster Randomised Trials in the Medical
Literature: Two Bibliometric Surveys.”</span> Talk presented to the RSS
Medical Section and RSS Liverpool Local Group. <a href="https://www-users.york.ac.uk/~mb55/talks/clusml.htm" class="external-link">https://www-users.york.ac.uk/~mb55/talks/clusml.htm</a>.
</div>
<div id="ref-JanShieh2018" class="csl-entry">
Jan, Show-Li, and Gwowen Shieh. 2018. <span>“The
<span>Bland-Altman</span> Range of Agreement: Exact Interval Procedure
and Sample Size Determination.”</span> <em>Comput. Biol. Med.</em> 100
(September): 247–52.
</div>
<div id="ref-lu2016" class="csl-entry">
Lu, Meng-Jie, Wei-Hua Zhong, Yu-Xiu Liu, Hua-Zhang Miao, Yong-Chang Li,
and Mu-Huo Ji. 2016. <span>“Sample Size for Assessing Agreement Between
Two Methods of Measurement by Bland-Altman Method.”</span> <em>The
International Journal of Biostatistics</em> 12 (2). <a href="https://doi.org/10.1515/ijb-2015-0039" class="external-link">https://doi.org/10.1515/ijb-2015-0039</a>.
</div>
<div id="ref-shieh2019" class="csl-entry">
Shieh, Gwowen. 2019. <span>“Assessing Agreement Between Two Methods of
Quantitative Measurements: Exact Test Procedure and Sample Size
Calculation.”</span> <em>Statistics in Biopharmaceutical Research</em>
12 (3): 352–59. <a href="https://doi.org/10.1080/19466315.2019.1677495" class="external-link">https://doi.org/10.1080/19466315.2019.1677495</a>.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Aaron Caldwell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
